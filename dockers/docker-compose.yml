# This grabs hadoop-VERSION-snapshot.tar from the hadoop-dist/target directory and create a hadoop docker image
version: '3.3'
name: hadoop-four-nodes
services:
  namenode:
    image: hdfs-runtime:latest
    restart: always
    environment:
      HDFS_DATANODE_USER: root
    ports:
      - "9870:9870"
    volumes:
      - ./core-site.xml:/opt/hadoop-3.5.0-SNAPSHOT/etc/hadoop/core-site.xml
      - ./hdfs-site.xml:/opt/hadoop-3.5.0-SNAPSHOT/etc/hadoop/hdfs-site.xml
      - volume-name-1:/data
    entrypoint: bash namenode-entrypoint.sh
    networks:
      - intra

  datanode-1:
    image: hdfs-runtime:latest
    restart: always
    volumes:
      - ./core-site.xml:/opt/hadoop-3.5.0-SNAPSHOT/etc/hadoop/core-site.xml
      - ./hdfs-site.xml:/opt/hadoop-3.5.0-SNAPSHOT/etc/hadoop/hdfs-site.xml
      - volume-data-1:/data
    entrypoint: hdfs datanode
    networks:
      - intra

  datanode-2:
    image: hdfs-runtime:latest
    restart: always
    volumes:
      - ./core-site.xml:/opt/hadoop-3.5.0-SNAPSHOT/etc/hadoop/core-site.xml
      - ./hdfs-site.xml:/opt/hadoop-3.5.0-SNAPSHOT/etc/hadoop/hdfs-site.xml
      - volume-data-2:/data
    entrypoint: hdfs datanode
    networks:
      - intra

  datanode-3:
    image: hdfs-runtime:latest
    restart: always
    volumes:
      - ./core-site.xml:/opt/hadoop-3.5.0-SNAPSHOT/etc/hadoop/core-site.xml
      - ./hdfs-site.xml:/opt/hadoop-3.5.0-SNAPSHOT/etc/hadoop/hdfs-site.xml
      - volume-data-3:/data
    entrypoint: hdfs datanode
    networks:
      - intra

  datanode-4:
    image: hdfs-runtime:latest
    restart: always
    volumes:
      - ./core-site.xml:/opt/hadoop-3.5.0-SNAPSHOT/etc/hadoop/core-site.xml
      - ./hdfs-site.xml:/opt/hadoop-3.5.0-SNAPSHOT/etc/hadoop/hdfs-site.xml
      - volume-data-4:/data
    entrypoint: hdfs datanode
    networks:
      - intra

networks:
    intra:

volumes:
  volume-name-1:
  volume-data-1:
  volume-data-2:
  volume-data-3:
  volume-data-4: